/**
 * almond 0.2.7 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(e,t){typeof define=="function"&&define.amd?define(t):e.PVSioWebClient=t()})(this,function(){var e,t,n;return function(r){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(e){if(d(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!d(a,e)&&!d(c,e))throw new Error("No "+e);return a[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(e,t,n,i){var s,l,h,p,v,g=[],w=typeof n,E;i=i||e;if(w==="undefined"||w==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(v=0;v<t.length;v+=1){p=o(t[v],i),l=p.f;if(l==="require")g[v]=u.require(e);else if(l==="exports")g[v]=u.exports(e),E=!0;else if(l==="module")s=g[v]=u.module(e);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=n?n.apply(a[e],g):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){return typeof e=="string"?u[e]?u[e](t):b(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond",function(){}),n("util/eventDispatcher",[],function(){return function(e){var t={},n=function(e){var n,r,i,s,o=typeof e=="string"?e:e.type;if(t.hasOwnProperty(o)){n=t[o];for(s=0;s<n.length;s++)i=n[s],r=i.method,typeof r=="string"&&(r=this[r]),r.apply(this,i.parameters||[e])}return this};e.fire=n;var r=function(e,n,r){var i={method:n,parameters:r};return t.hasOwnProperty(e)?t[e].push(i):t[e]=[i],this};e.addListener=r;var i=function(e,n){var r,i,s;if(t.hasOwnProperty(e)){r=t[e];for(i=0;i<r.length;i++)s=r[i],n===s.method&&r.splice(i,1)}};e.removeListener=i;var s=function(){return t={},this};return e.clearListeners=s,e}}),n("util/property",["util/eventDispatcher"],function(e){return function(t){var n=function(e){if(!arguments.length)return t;if(t!==e){var r={type:"PropertyChanged",old:t,fresh:e};t=e,n.fire(r)}return this};return n=e(n),n}}),n("util/uuidGenerator",["require","exports","module"],function(e,t,n){n.exports=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t==="x"?n:n&7|8).toString(16)});return t}}),n("websockets/events",{ConnectionOpened:"ConnectionOpened",ConnectionClosed:"ConnectionClosed",ConnectionTimedOut:"ConnectionTimedOut",UserAuthenticated:"UserAuthenticated",NoConnection:"NoConnection"}),n("websockets/wsClient",["require","exports","module","util/property","util/eventDispatcher","util/uuidGenerator","websockets/events"],function(e,t,n){var r=e("util/property"),i=e("util/eventDispatcher"),s=e("util/uuidGenerator"),o=e("websockets/events");n.exports=function(){var e=i({}),t,n={};return e.url=r.call(e,"ws://localhost"),e.logon=function(){return t||(t=new WebSocket(e.url()),t.onopen=function(t){e.fire({type:o.ConnectionOpened,event:t})},t.onclose=function(t){e.fire({type:o.ConnectionClosed,event:t})},t.onmessage=function(t){var r=JSON.parse(t.data);if(r.id&&typeof n[r.id]=="function"){var i=n[r.id];delete n[r.id],i.call(e,r.err,r)}else r.type&&e.fire(r)}),e},e.send=function(r,i){var o=s();return r&&r.type?(r.id=o,r.sent=(new Date).getTime(),n[o]=i,t.send(JSON.stringify(r))):console.log("Token is undefined"),e},e.close=function(){t&&t.close()},e}}),n("websockets/pvs/pvsWSClient",["require","exports","module","websockets/wsClient","util/eventDispatcher","util/property"],function(e,t,n){function u(){var e=r(),t=i({});return t.serverUrl=function(n){return n?(e.url(n),t):e.url()},t.lastState=s.call(t,"init(0)"),t.logon=function(){return e.logon(),t},t.close=function(){e.close()},t.startPVSProcess=function(t,n){var r=t.fileName.split(".pvs")[0];e.send({type:"startProcess",data:{fileName:r,projectName:t.projectName,demoName:t.demoName}},n)},t.sendGuiAction=function(n,r){return e.send({type:"sendCommand",data:{command:n}},r),e.fire({type:"InputUpdated",data:n}),t},t.getFile=function(n,r){var i={type:"readFile",fileName:n};return e.send(i,r),t},t.writeFile=function(n,r){var i={type:"writeFile",data:n};return e.send(i,r),t},t.send=function(n,r){return e.send(n,r),t},t.addListener=function(n,r){return e.addListener(n,r),t},t}var r=e("websockets/wsClient"),i=e("util/eventDispatcher"),s=e("util/property"),o;n.exports=function(){return o=o||u(),o}}),n("PVSioWebClient",["require","exports","module","websockets/pvs/pvsWSClient","util/eventDispatcher"],function(e,t,n){function o(){i(this);var e=this,t=8082,n=window.location.origin.indexOf("file")===0?"ws://localhost:"+t:"ws://"+window.location.hostname+":"+t;s=r().serverUrl(n).addListener("ConnectionOpened",function(t){e.fire(t.type="WebSocketConnectionOpened")}).addListener("ConnectionClosed",function(t){e.fire(t.type="WebSocketConnectionClosed")}).addListener("pvsoutput",function(t){e.fire(t)}).addListener("processExited",function(t){e.fire(t)})}var r=e("websockets/pvs/pvsWSClient"),i=e("util/eventDispatcher"),s;o.prototype.connectToServer=function(){return s.logon(),this},o.prototype.disconnectFromServer=function(){return s.close(),this},o.prototype.getWebSocket=function(){return s},o.prototype.registerPlugin=function(e){return e&&typeof e=="function"&&e(this),this},n.exports=o}),t("PVSioWebClient")});